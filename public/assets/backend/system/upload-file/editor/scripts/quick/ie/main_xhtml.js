function doCmd(idIframe,sCmd,sOption){var oEditor=eval(idIframe);var oSel=oEditor.document.selection.createRange();var sType=oEditor.document.selection.type;var oTarget=(sType=="None"?oEditor.document:oSel);oTarget.execCommand(sCmd,false,sOption)}function getHTMLBody(idIframe){var oEditor=eval(idIframe);sHTML=oEditor.document.body.innerHTML;sHTML=String(sHTML).replace(/\<PARAM NAME=\"Play\" VALUE=\"0\">/ig,'<PARAM NAME="Play" VALUE="-1">');return sHTML}function getXHTMLBody(idIframe){var oEditor=eval(idIframe);cleanDeprecated(idIframe);return recur(oEditor.document.body,"")}function insertHTML(h,c){var e=h;var a=e.document.selection.createRange();var g=String(c).match(/<A[^>]*>/ig);if(g){for(var b=0;b<g.length;b++){sTmp=g[b].replace(/href=/,"href_iwe=");c=String(c).replace(g[b],sTmp)}}var d=String(c).match(/<IMG[^>]*>/ig);if(d){for(var b=0;b<d.length;b++){sTmp=d[b].replace(/src=/,"src_iwe=");c=String(c).replace(d[b],sTmp)}}if(a.parentElement){a.pasteHTML(c)}else{a.item(0).outerHTML=c}for(var b=0;b<e.document.all.length;b++){if(e.document.all[b].getAttribute("href_iwe")){e.document.all[b].href=e.document.all[b].getAttribute("href_iwe");e.document.all[b].removeAttribute("href_iwe",0)}if(e.document.all[b].getAttribute("src_iwe")){e.document.all[b].src=e.document.all[b].getAttribute("src_iwe");e.document.all[b].removeAttribute("src_iwe",0)}}}function cleanDeprecated(idIframe){var oEditor=eval(idIframe);var elements;elements=oEditor.document.body.getElementsByTagName("STRIKE");cleanTags(idIframe,elements,"line-through");elements=oEditor.document.body.getElementsByTagName("S");cleanTags(idIframe,elements,"line-through");elements=oEditor.document.body.getElementsByTagName("U");cleanTags(idIframe,elements,"underline");replaceTags(idIframe,"DIR","DIV");replaceTags(idIframe,"MENU","DIV");replaceTags(idIframe,"CENTER","DIV");replaceTags(idIframe,"XMP","PRE");replaceTags(idIframe,"BASEFONT","SPAN");elements=oEditor.document.body.getElementsByTagName("APPLET");var count=elements.length;while(count>0){f=elements[0];f.removeNode(false);count--}cleanFonts(idIframe);cleanEmptySpan(idIframe);return true}function cleanEmptySpan(idIframe){var bReturn=false;var oEditor=eval(idIframe);var allSpans=oEditor.document.getElementsByTagName("SPAN");if(allSpans.length==0){return false}var emptySpans=[];var reg=/<\s*SPAN\s*>/gi;for(var i=0;i<allSpans.length;i++){if(allSpans[i].outerHTML.search(reg)==0){emptySpans[emptySpans.length]=allSpans[i]}}var theSpan,theParent;for(var i=0;i<emptySpans.length;i++){theSpan=emptySpans[i];theSpan.removeNode(false);bReturn=true}return bReturn}function cleanFonts(idIframe){var oEditor=eval(idIframe);var allFonts=oEditor.document.body.getElementsByTagName("FONT");if(allFonts.length==0){return false}var f;while(allFonts.length>0){f=allFonts[0];if(f.hasChildNodes&&f.childNodes.length==1&&f.childNodes[0].nodeType==1&&f.childNodes[0].nodeName=="SPAN"){copyAttribute(f.childNodes[0],f);f.removeNode(false)}else{if(f.parentElement.nodeName=="SPAN"&&f.parentElement.childNodes.length==1){copyAttribute(f.parentElement,f);f.removeNode(false)}else{var newSpan=oEditor.document.createElement("SPAN");copyAttribute(newSpan,f);newSpan.innerHTML=f.innerHTML;f.replaceNode(newSpan)}}}return true}function cleanTags(idIframe,elements,sVal){var oEditor=eval(idIframe);var f;while(elements.length>0){f=elements[0];if(f.hasChildNodes&&f.childNodes.length==1&&f.childNodes[0].nodeType==1&&f.childNodes[0].nodeName=="SPAN"){if(sVal=="bold"){f.childNodes[0].style.fontWeight="bold"}if(sVal=="italic"){f.childNodes[0].style.fontStyle="italic"}if(sVal=="line-through"){f.childNodes[0].style.textDecoration="line-through"}if(sVal=="underline"){f.childNodes[0].style.textDecoration="underline"}f.removeNode(false)}else{if(f.parentElement.nodeName=="SPAN"&&f.parentElement.childNodes.length==1){if(sVal=="bold"){f.parentElement.style.fontWeight="bold"}if(sVal=="italic"){f.parentElement.style.fontStyle="italic"}if(sVal=="line-through"){f.parentElement.style.textDecoration="line-through"}if(sVal=="underline"){f.parentElement.style.textDecoration="underline"}f.removeNode(false)}else{var newSpan=oEditor.document.createElement("SPAN");if(sVal=="bold"){newSpan.style.fontWeight="bold"}if(sVal=="italic"){newSpan.style.fontStyle="italic"}if(sVal=="line-through"){newSpan.style.textDecoration="line-through"}if(sVal=="underline"){newSpan.style.textDecoration="underline"}newSpan.innerHTML=f.innerHTML;f.replaceNode(newSpan)}}}}function replaceTags(idIframe,sFrom,sTo){var oEditor=eval(idIframe);var elements=oEditor.document.getElementsByTagName(sFrom);var newSpan;var count=elements.length;while(count>0){f=elements[0];newSpan=oEditor.document.createElement(sTo);newSpan.innerHTML=f.innerHTML;f.replaceNode(newSpan);count--}}function copyAttribute(b,c){if((c.face!=null)&&(c.face!="")){b.style.fontFamily=c.face}if((c.size!=null)&&(c.size!="")){var a="";if(c.size==1){a="8pt"}else{if(c.size==2){a="10pt"}else{if(c.size==3){a="12pt"}else{if(c.size==4){a="14pt"}else{if(c.size==5){a="18pt"}else{if(c.size==6){a="24pt"}else{if(c.size>=7){a="36pt"}else{if(c.size<=-2||c.size=="0"){a="8pt"}else{if(c.size=="-1"){a="10pt"}else{if(c.size==0){a="12pt"}else{if(c.size=="+1"){a="14pt"}else{if(c.size=="+2"){a="18pt"}else{if(c.size=="+3"){a="24pt"}else{if(c.size=="+4"||c.size=="+5"||c.size=="+6"){a="36pt"}else{a=""}}}}}}}}}}}}}}if(a!=""){b.style.fontSize=a}}if((c.style.backgroundColor!=null)&&(c.style.backgroundColor!="")){b.style.backgroundColor=c.style.backgroundColor}if((c.color!=null)&&(c.color!="")){b.style.color=c.color}}function GetElement(b,a){while(b!=null&&b.tagName!=a){if(b.tagName=="BODY"){return null}b=b.parentElement}return b}function lineBreak1(a){arrReturn=["\n","",""];if(a=="A"||a=="B"||a=="CITE"||a=="CODE"||a=="EM"||a=="FONT"||a=="I"||a=="SMALL"||a=="STRIKE"||a=="BIG"||a=="STRONG"||a=="SUB"||a=="SUP"||a=="U"||a=="SAMP"||a=="S"||a=="VAR"||a=="BASEFONT"||a=="KBD"||a=="TT"){arrReturn=["","",""]}if(a=="TEXTAREA"||a=="TABLE"||a=="THEAD"||a=="TBODY"||a=="TR"||a=="OL"||a=="UL"||a=="DIR"||a=="MENU"||a=="FORM"||a=="SELECT"||a=="MAP"||a=="DL"||a=="HEAD"||a=="BODY"||a=="HTML"){arrReturn=["\n","","\n"]}if(a=="STYLE"||a=="SCRIPT"){arrReturn=["\n","",""]}if(a=="BR"||a=="HR"){arrReturn=["","\n",""]}return arrReturn}function fixAttr(a){a=String(a).replace(/&/g,"&amp;");a=String(a).replace(/</g,"&lt;");a=String(a).replace(/"/g,"&quot;");return a}function fixVal(b){b=String(b).replace(/&/g,"&amp;");b=String(b).replace(/</g,"&lt;");var a=escape(b);a=unescape(a.replace(/\%A0/gi,"-*REPL*-"));b=a.replace(/-\*REPL\*-/gi,"&nbsp;");return b}function recur(h,b){var e="";for(var g=0;g<h.childNodes.length;g++){var n=h.childNodes(g);if(n.nodeType==1){var a=n.nodeName;var p=n.outerHTML;if(p.indexOf("<?xml:namespace")>-1){p=p.substr(p.indexOf(">")+1)}p=p.substring(1,p.indexOf(">"));if(p.indexOf(" ")>-1){p=p.substring(0,p.indexOf(" "))}var m=false;if(a.substring(0,1)=="/"){m=true}else{var d=b;e+=lineBreak1(a)[0];if(lineBreak1(a)[0]!=""){e+=d}}if(m){}else{if(a=="OBJECT"||a=="EMBED"){s=n.outerHTML;s=s.replace(/\"[^\"]*\"/ig,function(i){i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/\s+/ig,"#_#");return i});s=s.replace(/<([^ >]*)/ig,function(i){return i.toLowerCase()});s=s.replace(/ ([^=]+)=([^"' >]+)/ig,' $1="$2"');s=s.replace(/ ([^=]+)=/ig,function(i){return i.toLowerCase()});s=s.replace(/#_#/ig," ");s=s.replace(/<param([^>]*)>/ig,"\n<param$1 />").replace(/\/ \/>$/ig," />");if(a=="EMBED"){if(n.innerHTML==""){s=s.replace(/>$/ig," />").replace(/\/ \/>$/ig,"/>")}}s=s.replace(/<param name=\"Play\" value=\"0\" \/>/,'<param name="Play" value="-1" />');e+=s}else{if(a=="TITLE"){e+="<title>"+n.innerHTML+"</title>"}else{if(a=="AREA"){var c=n.coords;var k=n.shape}var l=n.cloneNode();if(n.checked){l.checked=n.checked}s=l.outerHTML.replace(/<\/[^>]*>/,"");s=s.replace(/(\r\n)+/,"");if(a=="STYLE"){var j=s.match(/<[^>]*>/ig);s=j[0]}s=s.replace(/\"[^\"]*\"/ig,function(i){i=i.replace(/&/g,"&amp;").replace(/&amp;amp;/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s+/ig,"#_#");return i});s=s.replace(/<([^ >]*)/ig,function(i){return i.toLowerCase()});s=s.replace(/ ([^=]+)=([^" >]+)/ig,' $1="$2"');s=s.replace(/ ([^=]+)=/ig,function(i){return i.toLowerCase()});s=s.replace(/#_#/ig," ");s=s.replace(/[<hr]?(noshade)/ig,'noshade="noshade"');s=s.replace(/[<input]?(checked)/ig,'checked="checked"');s=s.replace(/[<select]?(multiple)/ig,'multiple="multiple"');s=s.replace(/[<option]?(selected)/ig,'selected="true"');s=s.replace(/[<input]?(readonly)/ig,'readonly="readonly"');s=s.replace(/[<input]?(disabled)/ig,'disabled="disabled"');s=s.replace(/[<td]?(nowrap )/ig,'nowrap="nowrap" ');s=s.replace(/[<td]?(nowrap\>)/ig,'nowrap="nowrap">');s=s.replace(/ contenteditable=\"true\"/ig,"");if(a=="AREA"){s=s.replace(/ coords=\"0,0,0,0\"/ig,' coords="'+c+'"');s=s.replace(/ shape=\"RECT\"/ig,' shape="'+k+'"')}var o=true;if(a=="IMG"||a=="BR"||a=="AREA"||a=="HR"||a=="INPUT"||a=="BASE"||a=="LINK"){s=s.replace(/>$/ig," />").replace(/\/ \/>$/ig,"/>");o=false}e+=s;if(a!="TEXTAREA"){e+=lineBreak1(a)[1]}if(a!="TEXTAREA"){if(lineBreak1(a)[1]!=""){e+=d}}if(o){s=n.outerHTML;if(a=="SCRIPT"){s=s.replace(/<script([^>]*)>[\n+\s+\t+]*/ig,"<script$1>");s=s.replace(/[\n+\s+\t+]*<\/script>/ig,"<\/script>");s=s.replace(/<script([^>]*)>\/\/<!\[CDATA\[/ig,"");s=s.replace(/\/\/\]\]><\/script>/ig,"");s=s.replace(/<script([^>]*)>/ig,"");s=s.replace(/<\/script>/ig,"");s=s.replace(/^\s+/,"").replace(/\s+$/,"");e+="\n"+d+"//<![CDATA[\n"+d+s+"\n"+d+"//]]>\n"+d}if(a=="STYLE"){s=s.replace(/<style([^>]*)>[\n+\s+\t+]*/ig,"<style$1>");s=s.replace(/[\n+\s+\t+]*<\/style>/ig,"</style>");s=s.replace(/<style([^>]*)><!--/ig,"");s=s.replace(/--><\/style>/ig,"");s=s.replace(/<style([^>]*)>/ig,"");s=s.replace(/<\/style>/ig,"");s=s.replace(/^\s+/,"").replace(/\s+$/,"");e+="\n"+d+"<!--\n"+d+s+"\n"+d+"-->\n"+d}if(a=="DIV"||a=="P"){if(n.innerHTML==""||n.innerHTML=="&nbsp;"){e+="&nbsp;"}else{e+=recur(n,d+"\t")}}else{e+=recur(n,d+"\t")}if(a!="TEXTAREA"){e+=lineBreak1(a)[2]}if(a!="TEXTAREA"){if(lineBreak1(a)[2]!=""){e+=d}}e+="</"+p.toLowerCase()+">"}}}}}else{if(n.nodeType==3){e+=fixVal(n.nodeValue)}else{if(n.nodeType==8){if(n.outerHTML.substring(0,2)=="<%"){sTmp=(n.outerHTML.substring(2));sTmp=sTmp.substring(0,sTmp.length-2);sTmp=sTmp.replace(/^\s+/,"").replace(/\s+$/,"");var d=b;e+="\n"+d+"<%\n"+d+sTmp+"\n"+d+"%>\n"+d}else{sTmp=n.nodeValue;sTmp=sTmp.replace(/^\s+/,"").replace(/\s+$/,"");e+="\n"+d+"<!--\n"+d+sTmp+"\n"+d+"-->\n"+d}}else{}}}}return e}function toggleViewSource(a,b){if(a.checked){viewSource(b)}else{applySource(b)}}function viewSource(idIframe){var oEditor=eval(idIframe);var sHTML=getXHTMLBody(idIframe);var docBody=oEditor.document.body;docBody.innerHTML="";docBody.innerText=sHTML.replace(/\n+/,"")}function applySource(idIframe){var oEditor=eval(idIframe);var s=oEditor.document.documentElement.outerHTML;var arrTmp=s.split("<BODY");var beforeBody=arrTmp[0]+"<BODY"+arrTmp[1].substring(0,arrTmp[1].indexOf(">")+1);var afterBody=s.substr(s.indexOf("</BODY>"));var body=oEditor.document.body.innerText;var oDoc=oEditor.document.open("text/html","replace");oDoc.write(beforeBody+body+afterBody);oDoc.close();oEditor.document.body.contentEditable=true;oEditor.document.execCommand("2D-Position",true,true);oEditor.document.execCommand("MultipleSelection",true,true);oEditor.document.execCommand("LiveResize",true,true);oEditor.document.body.onmouseup=function(){oUtil.oEditor=oEditor}};