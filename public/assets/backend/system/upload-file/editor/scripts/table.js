function getNumOfColumns(b){var a=0;for(var f=0;f<b.rows.length;f++){var e=0;var d=b.rows[f];for(var c=0;c<d.cells.length;c++){var g=d.cells[c];e+=g.colSpan}if(e>a){a=e}}return a}function getCurrentRowLayout(oTable,oTR){var numOfCols=getNumOfColumns(oTable);var sTmp="[";for(var i=1;i<=numOfCols;i++){sTmp+="false,"}sTmp=sTmp.substr(0,sTmp.length-1);sTmp+="]";var arrAllCols=eval(sTmp);for(var i=0;i<oTR.rowIndex;i++){var oTR_tmp=oTable.rows[i];var m=0;for(var j=0;j<oTR_tmp.cells.length;j++){var oTD_tmp=oTR_tmp.cells[j];m+=oTD_tmp.colSpan;if(oTD_tmp.rowSpan>=oTR.rowIndex+1-i){for(var k=0;k<oTD_tmp.colSpan;k++){arrAllCols[m-1+k]=true}}}}return arrAllCols}function getAbsoluteCellIndex(a,e,g){var h=getCurrentRowLayout(a,e);var b=0;var d=false;for(var c=0;c<e.cells.length;c++){if(d==false){b+=e.cells[c].colSpan}if(g==e.cells[c]){d=true}}b=b-(g.colSpan-1);for(var c=0;c<b;c++){if(h[c]==true){b++}}var f=b;return f}function getNextRowLayout(oTable,oTR,oTD){var nCellIndex=getAbsoluteCellIndex(oTable,oTR,oTD);var numOfCols=getNumOfColumns(oTable);var sTmp="[";for(i=1;i<=numOfCols;i++){sTmp+="false,"}sTmp=sTmp.substr(0,sTmp.length-1);sTmp+="]";var arrTmp=eval(sTmp);var bFinish=false;var oTR_tmp=oTR;for(var k=0;k<oTD.rowSpan;k++){oTR_tmp=oTR_tmp.nextSibling}if(!oTR_tmp){return null}for(var i=0;i<oTR_tmp.rowIndex;i++){var oTR_before=oTable.rows[i];for(var j=0;j<oTR_before.cells.length;j++){var oTD_before=oTR_before.cells[j];if(oTD_before.rowSpan>=oTR_tmp.rowIndex+1-i){for(k=0;k<oTD_before.colSpan;k++){var indx=getAbsoluteCellIndex(oTable,oTR_before,oTD_before);arrTmp[indx-1+k]=true}}}}return arrTmp}function spanRow(){if(!parent.oUtil.obj.checkFocus()){return}var l=parent.oUtil.oEditor;var d=l.document.selection.createRange();var a=l.document.selection.type;var h=(d.parentElement!=null?GetElement(d.parentElement(),"TABLE"):GetElement(d.item(0),"TABLE"));if(h==null){return}var f=(d.parentElement!=null?GetElement(d.parentElement(),"TR"):GetElement(d.item(0),"TR"));if(f==null){return}var m=(d.parentElement!=null?GetElement(d.parentElement(),"TD"):GetElement(d.item(0),"TD"));if(m==null){return}var c=getNumOfColumns(h);var b=getAbsoluteCellIndex(h,f,m);oTR_tmp=f;for(var e=0;e<m.rowSpan;e++){oTR_tmp=oTR_tmp.nextSibling}if(!oTR_tmp){return false}var g=getNextRowLayout(h,f,m);nCount=0;for(i=0;i<b;i++){if(g[i]==true){nCount++}}numOfTrue=nCount;nCount=numOfTrue;iResult=0;bFinish=false;for(i=0;i<oTR_tmp.cells.length;i++){oTD_tmp=oTR_tmp.cells[i];nCount+=oTD_tmp.colSpan;if(nCount>=b&&bFinish==false){nCount=nCount-(oTD_tmp.colSpan-1);if(nCount==b){if(oTD_tmp.colSpan==m.colSpan){nn=oTD_tmp.rowSpan;iResult=i;bFinish=true}else{return false}}else{return false}}}nTmp=m.rowSpan;m.rowSpan=m.rowSpan+nn;oTR_tmp.deleteCell(iResult);return true}function splitRow(){if(!parent.oUtil.obj.checkFocus()){return}var l=parent.oUtil.oEditor;var e=l.document.selection.createRange();var a=l.document.selection.type;var h=(e.parentElement!=null?GetElement(e.parentElement(),"TABLE"):GetElement(e.item(0),"TABLE"));if(h==null){return}var f=(e.parentElement!=null?GetElement(e.parentElement(),"TR"):GetElement(e.item(0),"TR"));if(f==null){return}var m=(e.parentElement!=null?GetElement(e.parentElement(),"TD"):GetElement(e.item(0),"TD"));if(m==null){return}if(m.rowSpan==1){return}var c=getNumOfColumns(h);var b=getAbsoluteCellIndex(h,f,m);if(!f.nextSibling){return}var g=getCurrentRowLayout(h,f.nextSibling);nCount=0;for(i=0;i<b;i++){if(g[i]==true){nCount++}}numOfTrue=nCount;nPoint=b-numOfTrue;nCount=0;iResult=0;oTR_tmp=f.nextSibling;bFinish=false;for(i=0;i<oTR_tmp.cells.length;i++){oTD_tmp=oTR_tmp.cells[i];nCount+=oTD_tmp.colSpan;if(nCount>nPoint&&bFinish==false){iResult=i;bFinish=true}else{if(bFinish==false){iResult=i+1}}}nTmp=m.rowSpan;m.rowSpan=1;var d=oTR_tmp.insertCell(iResult);d.innerHTML="New Cell";d.rowSpan=nTmp-1}function spanCol(){if(!parent.oUtil.obj.checkFocus()){return}var e=parent.oUtil.oEditor;var a=e.document.selection.createRange();var f=e.document.selection.type;var b=(a.parentElement!=null?GetElement(a.parentElement(),"TABLE"):GetElement(a.item(0),"TABLE"));if(b==null){return}var c=(a.parentElement!=null?GetElement(a.parentElement(),"TR"):GetElement(a.item(0),"TR"));if(c==null){return}var d=(a.parentElement!=null?GetElement(a.parentElement(),"TD"):GetElement(a.item(0),"TD"));if(d==null){return}if(d.nextSibling){if(d.rowSpan==d.nextSibling.rowSpan){d.colSpan+=d.nextSibling.colSpan;c.deleteCell(d.nextSibling.cellIndex)}}}function splitCol(){if(!parent.oUtil.obj.checkFocus()){return}var e=parent.oUtil.oEditor;var a=e.document.selection.createRange();var g=e.document.selection.type;var b=(a.parentElement!=null?GetElement(a.parentElement(),"TABLE"):GetElement(a.item(0),"TABLE"));if(b==null){return}var c=(a.parentElement!=null?GetElement(a.parentElement(),"TR"):GetElement(a.item(0),"TR"));if(c==null){return}var d=(a.parentElement!=null?GetElement(a.parentElement(),"TD"):GetElement(a.item(0),"TD"));if(d==null){return}if(d.colSpan==1){return}if(d.nextSibling){if(d.rowSpan!=d.nextSibling.rowSpan){return}}d.colSpan--;var f=c.insertCell(d.cellIndex+1);f.innerHTML="New Cell"}function insertRow(a){if(a=="Above"){rowOperation(false,true,false,false)}else{rowOperation(false,false,true,false)}}function insertCol(a){if(a=="Left"){colOperation(false,true,false,false)}else{colOperation(false,false,true,false)}}function delRow(){rowOperation(false,false,false,true)}function delCol(){colOperation(false,false,false,true)}function colOperation(bGetArrayCells,bDoInsertColumnLeft,bDoInsertColumnRight,bDeleteColumn){if(!parent.oUtil.obj.checkFocus()){return}var oEditor=parent.oUtil.oEditor;var oSel=oEditor.document.selection.createRange();var sType=oEditor.document.selection.type;var oTable=(oSel.parentElement!=null?GetElement(oSel.parentElement(),"TABLE"):GetElement(oSel.item(0),"TABLE"));if(oTable==null){return}var oTR=(oSel.parentElement!=null?GetElement(oSel.parentElement(),"TR"):GetElement(oSel.item(0),"TR"));if(oTR==null){return}var oTD=(oSel.parentElement!=null?GetElement(oSel.parentElement(),"TD"):GetElement(oSel.item(0),"TD"));if(oTD==null){return}var bCannotDelete=false;sArrCols="";var nCellIndex=getAbsoluteCellIndex(oTable,oTR,oTD);nColSpan=oTD.colSpan;for(var i=0;i<oTable.rows.length;i++){var oTR_tmp=oTable.rows[i];arrTmp=getCurrentRowLayout(oTable,oTR_tmp);if(arrTmp[nCellIndex-1]!=true){nCount=0;for(j=0;j<nCellIndex;j++){if(arrTmp[j]==true){nCount++}}numOfTrue=nCount;nCount=numOfTrue;bFinish=false;for(k=0;k<oTR_tmp.cells.length;k++){oTD_tmp=oTR_tmp.cells[k];nCount+=oTD_tmp.colSpan;if(nCount>=nCellIndex&&bFinish==false){nCount=nCount-(oTD_tmp.colSpan-1);if(nCount==nCellIndex){if(bDoInsertColumnLeft||bDoInsertColumnRight){if(oTD_tmp.colSpan>1){oTD_tmp.colSpan=oTD_tmp.colSpan+1}else{if(bDoInsertColumnLeft){var oNewCell=oTR_tmp.insertCell(oTD_tmp.cellIndex);oNewCell.style.cssText=oTD_tmp.style.cssText;oNewCell.innerHTML="New Cell";oNewCell.rowSpan=oTD_tmp.rowSpan}else{var oNewCell=oTR_tmp.insertCell(oTD_tmp.cellIndex+1);oNewCell.style.cssText=oTD_tmp.style.cssText;oNewCell.innerHTML="New Cell";oNewCell.rowSpan=oTD_tmp.rowSpan}}}if(oTD_tmp.colSpan==nColSpan){sArrCols+="["+i+","+oTD_tmp.cellIndex+"],"}else{sArrCols+="["+i+","+oTD_tmp.cellIndex+"],";if(bDeleteColumn){alert(getTxt("Cannot delete column."));return}}}else{if(bDoInsertColumnLeft||bDoInsertColumnRight){oTD_tmp.colSpan=oTD_tmp.colSpan+1}if(bDeleteColumn){alert(getTxt("Cannot delete column."));return}}bFinish=true}}}}var arrCols=eval("["+sArrCols.substring(0,sArrCols.length-1)+"]");if(bGetArrayCells){return arrCols}if(bDeleteColumn){for(var i=0;i<arrCols.length;i++){var rowIndex=arrCols[i][0];var colIndex=arrCols[i][1];oTable.rows[rowIndex].deleteCell(colIndex)}var it=0;while(it<oTable.rows.length){if(oTable.rows[it].cells.length==0){oTable.deleteRow(it)}else{it++}}if(oTable.rows.length==0){oTable.parentNode.removeChild(oTable)}}}function rowOperation(bGetArrayCells,bDoInsertRowAbove,bDoInsertRowBelow,bDeleteRow){if(!parent.oUtil.obj.checkFocus()){return}var oEditor=parent.oUtil.oEditor;var oSel=oEditor.document.selection.createRange();var sType=oEditor.document.selection.type;var oTable=(oSel.parentElement!=null?GetElement(oSel.parentElement(),"TABLE"):GetElement(oSel.item(0),"TABLE"));if(oTable==null){return}var oTR=(oSel.parentElement!=null?GetElement(oSel.parentElement(),"TR"):GetElement(oSel.item(0),"TR"));if(oTR==null){return}var oTD=(oSel.parentElement!=null?GetElement(oSel.parentElement(),"TD"):GetElement(oSel.item(0),"TD"));if(oTD==null){return}if(bGetArrayCells){var sTmp="[";for(var i=0;i<oTR.cells.length;i++){sTmp+="["+oTR.rowIndex+","+oTR.cells[i].cellIndex+"],"}sTmp=sTmp.substr(0,sTmp.length-1)+"]";return eval(sTmp)}var bCannotDelete=false;var numOfCols=getNumOfColumns(oTable);var sTmp="[";for(var i=1;i<=numOfCols;i++){sTmp+="[null,false],"}sTmp=sTmp.substr(0,sTmp.length-1);sTmp+="]";var arrAllCols=eval(sTmp);for(var i=0;i<oTR.rowIndex;i++){var oTR_tmp=oTable.rows[i];var m=0;for(var j=0;j<oTR_tmp.cells.length;j++){var oTD_tmp=oTR_tmp.cells[j];m+=oTD_tmp.colSpan;if(oTD_tmp.rowSpan>=oTR.rowIndex+1-i){for(var k=0;k<oTD_tmp.colSpan;k++){arrAllCols[m-1+k][0]=oTD_tmp;arrAllCols[m-1+k][1]=true;if(bDeleteRow){alert(getTxt("Cannot delete row."));return}}}}}nCount=0;for(var i=0;i<oTR.cells.length;i++){var oTD_tmp=oTR.cells[i];while(arrAllCols[nCount][0]!=null){nCount++}if(nCount<=numOfCols){if(bDoInsertRowAbove){for(var j=0;j<oTD_tmp.colSpan;j++){arrAllCols[nCount+j][0]=oTD_tmp;arrAllCols[nCount+j][1]=false}nCount=nCount+j}if(bDoInsertRowBelow){if(oTD_tmp.rowSpan>1){for(var j=0;j<oTD_tmp.colSpan;j++){arrAllCols[nCount+j][0]=oTD_tmp;arrAllCols[nCount+j][1]=true}}else{for(var j=0;j<oTD_tmp.colSpan;j++){arrAllCols[nCount+j][0]=oTD_tmp;arrAllCols[nCount+j][1]=false}}nCount=nCount+j}}}if(bDoInsertRowAbove){var oNewRow=oTable.insertRow(oTR.rowIndex)}if(bDoInsertRowBelow){var oNewRow=oTable.insertRow(oTR.rowIndex+1)}var oTD_Prev=null;for(var i=0;i<arrAllCols.length;i++){var oTD_tmp=arrAllCols[i][0];if(oTD_tmp!=oTD_Prev){if(bDoInsertRowAbove||bDoInsertRowBelow){if(arrAllCols[i][1]==true){oTD_tmp.rowSpan=oTD_tmp.rowSpan+1}else{oNewTD=oNewRow.insertCell();oNewTD.style.cssText=oTD_tmp.style.cssText;oNewTD.innerHTML="New Cell";oNewTD.colSpan=oTD_tmp.colSpan}}}oTD_Prev=oTD_tmp}if(bDeleteRow){oTable.deleteRow(oTR.rowIndex);if(oTable.rows.length==0){oTable.parentNode.removeChild(oTable)}}};